const e=/^[0-9]+$/;var t=function(t){let r=t.split("/");for(let t=1;t<r.length;t+=1)r[t]=r[t].replace(/~1/g,"/").replace(/~0/g,"~"),e.test(r[t])&&(r[t]=parseInt(r[t],10));return r.length>1&&""===r[r.length-1]&&r.pop(),r};const r=function(e){return"[object Array]"===Object.prototype.toString.call(e)},p=function(e){return"number"==typeof e&&isFinite(e)},a=function(e){return"[object Object]"===Object.prototype.toString.call(e)};var n=function(e,r){if(!e)return r;let p=e;"string"==typeof e&&(p=t(e)),""===p[0]&&p.shift();let a=r;for(let e=0;e<p.length;e+=1){let t=p[e];if("-"===t)a=a[a.length-1];else if("number"==typeof t)a=a[t];else{if(!a.hasOwnProperty(t))return;a=a[t]}}return a};var o=function(e){return e&&0!==e.length?"/"+(e=e.map((e=>(e=String(e),e.replace(/~[^01]/g,"~0").replace(/\//g,"~1"))))).join("/"):""};var l=function(e,p){let o="",l=t(e);l.length>1&&(o=l.pop());let i=n(l,p);return r(i)||a(i)||(i=void 0),{parent:i,prop:o}};var i=(e,t)=>{let o=n(e.path,t);if(!0===r(o))return void o.push(e.value);if(!0===a(o)&&!0===a(e.value))return void Object.assign(o,e.value);let i=l(e.path,t);r(i.parent)&&("-"===i.prop?i.parent.push(e.value):p(i.prop)&&i.parent.splice(i.prop,0,e.value)),a(i.parent)&&"string"==typeof i.prop&&(i.parent[i.prop]=e.value)};var u=(e,t)=>{let n=l(e.path,t);a(n.parent)&&delete n.parent[n.prop],r(n.parent)&&p(n.prop)&&n.parent.splice(n.prop,1)};var c=(e,t)=>{let r=n(e.from,t),p={op:"remove",path:e.from};u(p,t);let a={op:"add",path:e.path,value:r};i(a,t)};var f=(e,t)=>{let r=n(e.from,t),p={op:"add",path:e.path,value:r};i(p,t)};const s={add:i,remove:u,replace:(e,t)=>{let n=l(e.path,t);a(n.parent)&&(n.parent[n.prop]=e.value),r(n.parent)&&p(n.prop)&&(n.parent[n.prop]=e.value)},move:c,copy:f,test:(e,t)=>{let r=n(e.path,t);if(JSON.stringify(r)!==JSON.stringify(e.value))throw new Error(`garbage-patch error: patch-test failed '${e.path}'`)}};var h=function(e,t){return r(e)||(e=[e]),e.forEach((e=>{s[e.op]&&s[e.op](e,t)})),t};export{h as apply,n as get,l as getParent,o as make};
